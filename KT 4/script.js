// 5 звёзд: клик → сохранить в localStorage → перерисовать
document.addEventListener('DOMContentLoaded', () => {
  // Ждём, когда весь HTML загрузится и будет готов к работе

  document.querySelectorAll('.stars').forEach((box, i) => {
    // Находим все элементы с классом .stars и перебираем их
    // box — это текущий контейнер для звёзд
    // i — порядковый номер контейнера (0, 1, 2 ...)

    const key = box.dataset.key || `stars-${i}`;
    // Ключ для хранения в localStorage:
    //   если у контейнера задан атрибут data-key="...", берём его
    //   если нет — формируем автоматически "stars-0", "stars-1" и т. д.

    let rating = +(localStorage.getItem(key) || box.dataset.rating || 0);
    // Пытаемся взять сохранённое значение из localStorage по ключу
    // Если его нет, берём стартовое значение из data-rating
    // Если и его нет — используем 0
    // + перед скобками превращает строку в число

    draw(box, rating);
    // Первичная отрисовка звёзд внутри контейнера

    box.addEventListener('click', (e) => {
      // Вешаем обработчик клика на контейнер со звёздами

      if (!(e.target instanceof HTMLElement)) return;
      // Проверяем, что кликнули именно по HTML-элементу (а не по пустоте)

      if (!e.target.classList.contains('s')) return;
      // Если кликнули не по звезде (у нас звёзды имеют класс .s) — ничего не делаем

      rating = [...box.children].indexOf(e.target) + 1;
      // Определяем номер нажатой звезды:
      // превращаем коллекцию детей контейнера в массив [...box.children]
      // находим индекс звезды, по которой кликнули
      // индекс начинается с 0, поэтому прибавляем +1

      localStorage.setItem(key, rating);
      // Сохраняем новое значение рейтинга в localStorage

      draw(box, rating);
      // Перерисовываем звёзды с учётом нового значения
    });
  });
});

// Отрисовать 5 звёзд в контейнере box для значения rating
function draw(box, rating) {
  box.innerHTML = ''; 
  // Сначала очищаем контейнер, чтобы заново построить звёзды

  for (let i = 1; i <= 5; i++) {
    // Создаём 5 звёзд: от 1 до 5

    const el = document.createElement('span');
    // Создаём новый <span> для звезды

    el.className = 's';
    // Добавляем класс .s, чтобы потом можно было распознать клики по звезде

    el.textContent = i <= rating ? '★' : '☆';
    // Если номер звезды (i) меньше или равен текущему рейтингу → закрашенная ★
    // иначе пустая ☆

    box.appendChild(el);
    // Вставляем звезду в контейнер
  }
}